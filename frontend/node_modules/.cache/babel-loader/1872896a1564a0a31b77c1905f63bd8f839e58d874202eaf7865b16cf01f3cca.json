{"ast":null,"code":"import _regeneratorRuntime from\"/Users/loicpeyramaure/Gw2 Talk/Gw2-Talk/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/loicpeyramaure/Gw2 Talk/Gw2-Talk/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/loicpeyramaure/Gw2 Talk/Gw2-Talk/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{jwtDecode}from'jwt-decode';import logo from\"./images/logo.svg\";import defaultAvatar from'./images/default-avatar.png';import'./DisplayPosts.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function DisplayPosts(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var navigate=useNavigate();var token=localStorage.getItem('token');var currentUserId=null;if(token){try{var decodedToken=jwtDecode(token);currentUserId=decodedToken.userId;}catch(error){console.error('Error decoding token:',error);}}useEffect(function(){var fetchPosts=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/get-posts\"));case 3:response=_context.sent;setPosts(response.data);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.error('Error fetching posts:',_context.t0);case 10:case\"end\":return _context.stop();}},_callee,null,[[0,7]]);}));return function fetchPosts(){return _ref.apply(this,arguments);};}();fetchPosts();},[]);var navigateToAccount=function navigateToAccount(){navigate('/create-post');};var handleDeletePost=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(postId){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(token){_context2.next=3;break;}console.error('Authentication token not found');return _context2.abrupt(\"return\");case 3:_context2.next=5;return axios.delete(\"\".concat(process.env.REACT_APP_API_BASE_URL,\"0/posts/\").concat(postId),{headers:{'Authorization':\"Bearer \".concat(token)}});case 5:setPosts(posts.filter(function(post){return post.id!==postId;}));case 6:case\"end\":return _context2.stop();}},_callee2);}));return function handleDeletePost(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"main-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header1\",children:[/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"Logo\"}),/*#__PURE__*/_jsx(\"span\",{onClick:function onClick(){return navigate('/account');},children:\"Mon compte\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"banner\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Bienvenue dans mon forum GW2\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"discussions-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Discussions\"}),/*#__PURE__*/_jsx(\"span\",{onClick:navigateToAccount,children:\"\\uFF0B\"})]}),posts.map(function(post){return/*#__PURE__*/_jsxs(\"div\",{className:\"post\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-user-info\",children:[/*#__PURE__*/_jsx(\"img\",{src:post.compteImage?\"\".concat(process.env.REACT_APP_API_BASE_URL,\"/\").concat(post.compteImage):defaultAvatar,alt:\"\".concat(post.userName?post.userName:\"User\",\"'s avatar\")}),/*#__PURE__*/_jsxs(\"span\",{children:[post.userName,\" / \",post.gw2_account_name]})]}),/*#__PURE__*/_jsx(\"h3\",{onClick:function onClick(){return navigate(\"/posts/\".concat(post.id));},children:post.title}),/*#__PURE__*/_jsxs(\"p\",{children:[post.content.substring(0,100),\"...\"]}),currentUserId&&post.user_id===currentUserId&&/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return handleDeletePost(post.id);},title:\"Supprimer poste\",children:\"\\u274C\"}),posts.length-1!==posts.indexOf(post)&&/*#__PURE__*/_jsx(\"hr\",{className:\"hr-style\"})]},post.id);}),/*#__PURE__*/_jsxs(\"div\",{className:\"footer\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Contact: lpeyramaure@eduvaud.ch\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Nombre d'inscrits: 451\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Nombre de posts: 645\"})]})]});}export default DisplayPosts;","map":{"version":3,"names":["React","useState","useEffect","axios","useNavigate","jwtDecode","logo","defaultAvatar","jsx","_jsx","jsxs","_jsxs","DisplayPosts","_useState","_useState2","_slicedToArray","posts","setPosts","navigate","token","localStorage","getItem","currentUserId","decodedToken","userId","error","console","fetchPosts","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","wrap","_callee$","_context","prev","next","get","concat","process","env","REACT_APP_API_BASE_URL","sent","data","t0","stop","apply","arguments","navigateToAccount","handleDeletePost","_ref2","_callee2","postId","_callee2$","_context2","abrupt","delete","headers","filter","post","id","_x","className","children","src","alt","onClick","map","compteImage","userName","gw2_account_name","title","content","substring","user_id","length","indexOf"],"sources":["/Users/loicpeyramaure/Gw2 Talk/Gw2-Talk/frontend/src/DisplayPosts.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport { jwtDecode } from 'jwt-decode';\nimport logo from \"./images/logo.svg\";\nimport defaultAvatar from './images/default-avatar.png';\nimport './DisplayPosts.css';\n\nfunction DisplayPosts() {\n    const [posts, setPosts] = useState([]);\n    const navigate = useNavigate();\n    const token = localStorage.getItem('token');\n    let currentUserId = null;\n    if (token) {\n        try {\n            const decodedToken = jwtDecode(token);\n            currentUserId = decodedToken.userId;\n        } catch (error) {\n            console.error('Error decoding token:', error);\n        }\n    }\n\n    useEffect(() => {\n        const fetchPosts = async () => {\n            try {\n                const response = await axios.get(`${process.env.REACT_APP_API_BASE_URL}/get-posts`);\n                setPosts(response.data);\n            } catch (error) {\n                console.error('Error fetching posts:', error);\n            }\n        };\n        fetchPosts();\n    }, []);\n\n    const navigateToAccount = () => {\n        navigate('/create-post');\n    };\n\n    const handleDeletePost = async (postId) => {\n        if (!token) {\n            console.error('Authentication token not found');\n            return;\n        }\n        await axios.delete(`${process.env.REACT_APP_API_BASE_URL}0/posts/${postId}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        setPosts(posts.filter(post => post.id !== postId));\n    };\n\n    return (\n        <div className=\"main-container\">\n            {/* Header */}\n            <div className=\"header1\">\n                <img src={logo} alt='Logo' />\n                <span onClick={() => navigate('/account')}>Mon compte</span>\n            </div>\n\n            {/* Banner */}\n            <div className=\"banner\">\n                <h1>Bienvenue dans mon forum GW2</h1>\n            </div>\n\n            {/* Discussions Header */}\n            <div className=\"discussions-header\">\n                <h2>Discussions</h2>\n                <span onClick={navigateToAccount}>＋</span>\n            </div>\n\n            {/* Posts */}\n            {posts.map((post) => (\n                <div key={post.id} className=\"post\">\n                    <div className=\"post-user-info\">\n                        <img\n                            src={post.compteImage ? `${process.env.REACT_APP_API_BASE_URL}/${post.compteImage}` : defaultAvatar}\n                            alt={`${post.userName ? post.userName : \"User\"}'s avatar`}\n                        />\n                        <span>{post.userName} / {post.gw2_account_name}</span>\n                    </div>\n                    <h3 onClick={() => navigate(`/posts/${post.id}`)}>{post.title}</h3>\n                    <p>{post.content.substring(0, 100)}...</p>\n                    {currentUserId && post.user_id === currentUserId && (\n                        <button onClick={() => handleDeletePost(post.id)} title=\"Supprimer poste\">❌</button>\n                    )}\n                    {posts.length - 1 !== posts.indexOf(post) && (\n    <hr className=\"hr-style\" />\n)}\n                </div>\n            ))}\n\n            {/* Footer */}\n            <div className=\"footer\">\n                <p>Contact: lpeyramaure@eduvaud.ch</p>\n                <p>Nombre d'inscrits: 451</p>\n                <p>Nombre de posts: 645</p>\n            </div>\n        </div>\n    );\n}\n\nexport default DisplayPosts;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}